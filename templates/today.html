{% extends "base.html" %}
{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-24">
  <div class="lg:col-span-2">
    <div class="rounded-2xl border border-emerald-100 bg-white p-6 shadow-sm">
      <div class="text-center mb-4">
        <div class="text-emerald-600 font-semibold text-xl">Today's Pick</div>
        <div class="text-gray-500">Perfectly timed for your schedule</div>
      </div>
      <div class="rounded-xl overflow-hidden bg-gray-100 h-56 mb-4">
        <img src="{{ pick.image_url or '/static/img/placeholder.jpg' }}" class="w-full h-full object-cover" alt="dish">
      </div>
      <div class="mb-2 text-2xl font-semibold">{{ pick.name }}</div>
      <div class="text-gray-600 mb-3">{{ pick.cuisine or '‚Äî' }} ‚Ä¢ {{ pick.difficulty or '‚Äî' }}</div>
      <div class="flex items-center gap-2 mb-3">
        {% if pick.spice_level in ['High','Spicy'] %}<span class="px-3 py-1 rounded-full bg-red-100 text-red-600 text-sm">Spicy</span>{% endif %}
        {% if pick.cuisine %}<span class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 text-sm">{{ pick.cuisine }}</span>{% endif %}
      </div>
      <div class="flex items-center gap-2 text-gray-500 text-sm mb-4">
        <span class="inline-flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"/></svg>{{ pick.time_min or 0 }}m</span>
        {% if days_ago(pick.last_cooked_at) is not none %}
        <span class="inline-flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3M3 11h18M5 19h14"/></svg>Last cooked {{ days_ago(pick.last_cooked_at) }}d ago</span>
        {% endif %}
      </div>
      <form method="post" action="{{ url_for('cook') }}">
        <input type="hidden" name="dish_id" value="{{ pick.id }}">
        <button class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-semibold rounded-xl py-3">Cook Today</button>
      </form>
      <div class="grid grid-cols-2 gap-3 mt-3">
        <button id="swapBtn" data-id="{{ pick.id }}" class="w-full border rounded-xl py-3 text-gray-700">Swap</button>
        <a href="{{ url_for('override_get') }}" class="w-full text-center border rounded-xl py-3 text-gray-700">Override</a>
      </div>
    </div>
    <div class="mt-6">
      <div class="flex items-center justify-between mb-2">
        <div class="text-lg font-semibold">Recent Meals</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for r in recent %}
        <div class="rounded-2xl border bg-white p-4">
          <div class="h-28 bg-gradient-to-br from-emerald-50 to-amber-50 rounded-xl mb-3 flex items-center justify-center">
            <span class="text-gray-400 text-2xl">üçΩÔ∏è</span>
          </div>
          <div class="font-semibold">{{ r.name }}</div>
          <div class="text-sm text-gray-500">{{ r.cuisine or '‚Äî' }}</div>
          <div class="flex items-center gap-3 text-sm text-gray-600 mt-2">
            <span class="inline-flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"/></svg>{{ r.time_min or 0 }}m</span>
            <span class="inline-flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3M3 11h18M5 19h14"/></svg>{{ (r.cooked_date.strftime('%-d') if r.cooked_date else '') }}{{ r.cooked_date.strftime('/%m/%Y') if r.cooked_date else '' }}</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="lg:col-span-1">
    <div class="rounded-2xl border bg-white p-4">
      <div class="font-semibold mb-2">Alternatives</div>
      <div id="altList" class="space-y-3">
        {% for a in alts %}
        <div class="border rounded-xl p-3">
          <div class="font-medium">{{ a.name }}</div>
          <div class="text-sm text-gray-500">{{ a.cuisine or '‚Äî' }} ‚Ä¢ {{ a.time_min or 0 }}m</div>
          <form method="post" action="{{ url_for('cook') }}" class="mt-2">
            <input type="hidden" name="dish_id" value="{{ a.id }}">
            <button class="w-full border rounded-lg py-2">Choose</button>
          </form>
        </div>
        {% endfor %}
      </div>
    </div>
    <div class="rounded-2xl border bg-amber-50 text-amber-900 p-4 mt-4">
      <div class="font-medium">Keep variety high</div>
      <div class="text-sm">Add 5 more dishes to avoid repeats</div>
    </div>
  </div>
</div>
<script>
const btn=document.getElementById('swapBtn')
if(btn){btn.addEventListener('click',async()=>{const id=btn.dataset.id;const r=await fetch('/swap',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'dish_id='+id});const alts=await r.json();const c=document.getElementById('altList');c.innerHTML='';alts.forEach(a=>{c.innerHTML+=`<div class="border rounded-xl p-3"><div class="font-medium">${a.name}</div><div class="text-sm text-gray-500">${a.cuisine||'‚Äî'} ‚Ä¢ ${a.time_min||0}m</div><form method="post" action="/cook" class="mt-2"><input type="hidden" name="dish_id" value="${a.id}"><button class="w-full border rounded-lg py-2">Choose</button></form></div>`})})}
</script>
{% endblock %}
