{% extends "base.html" %}
{% block content %}
<div class="mb-24">
  <div class="text-2xl font-semibold mb-4">History</div>

  <form method="get" class="mb-4 flex gap-2">
    <input type="hidden" name="period" value="{{ period }}">
    <input type="hidden" name="type" value="{{ typ }}">
    <input name="q" value="{{ q }}" placeholder="Search by name..." class="w-full rounded-xl border px-4 py-3">
    <button class="px-4 py-3 rounded-xl bg-emerald-600 text-white">Search</button>
  </form>

  <div class="flex flex-wrap gap-2 mb-3">
    {% for key,label in [('all','All time'),('today','Today'),('yesterday','Yesterday'),('7d','Past 7d'),('15d','Past 15d'),('30d','Past 30d'),('365d','Past Year')] %}
      <a href="{{ url_for_history(period=key, page=1) }}" class="px-3 py-1 rounded-full border text-sm {% if period==key %}bg-emerald-600 text-white border-emerald-600{% else %}bg-white text-gray-700{% endif %}">{{ label }}</a>
    {% endfor %}
  </div>

  <div class="flex flex-wrap gap-2 mb-4">
    {% for key,label in [('all','All'),('cooked','Cooked'),('override','Override')] %}
      <a href="{{ url_for_history(type=key, page=1) }}" class="px-3 py-1 rounded-full border text-sm {% if typ==key %}bg-emerald-600 text-white border-emerald-600{% else %}bg-white text-gray-700{% endif %}">{{ label }}</a>
    {% endfor %}
  </div>

  {% if rows %}
  <div class="space-y-4">
    {% for r in rows %}
    <div class="rounded-2xl border bg-white p-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <img src="{{ r.image_url or '/static/img/placeholder.jpg' }}" class="h-16 w-24 rounded-lg object-cover">
        <div>
          <div class="font-semibold">{{ r.name }}</div>
          <div class="text-sm text-gray-500">{{ r.cuisine or '—' }} • {{ r.time_min or 0 }}m</div>
          <div class="flex items-center gap-2 mt-1">
            {% if r.is_override %}
              <span class="px-2 py-1 rounded-full bg-amber-100 text-amber-700 text-xs">Override</span>
            {% else %}
              <span class="px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs">Cooked</span>
            {% endif %}
            <span class="px-2 py-1 rounded-full bg-gray-100 text-gray-700 text-xs">{{ r.time_min or 0 }}m</span>
          </div>
        </div>
      </div>
      <div class="text-sm text-gray-600">{{ r.cooked_date.strftime('%m/%d/%Y') if r.cooked_date else '' }}</div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="rounded-2xl border bg-white p-6 text-center text-gray-500">No entries</div>
  {% endif %}

  {% if pages > 1 %}
  <div class="mt-6 flex items-center justify-between">
    <a href="{{ url_for_history(page=page-1 if page>1 else 1) }}" class="px-4 py-2 rounded-lg border {% if page==1 %}opacity-50 pointer-events-none{% endif %}">Prev</a>
    <div class="text-sm text-gray-600">Page {{ page }} of {{ pages }} • {{ total }} items</div>
    <a href="{{ url_for_history(page=page+1 if page<pages else pages) }}" class="px-4 py-2 rounded-lg border {% if page==pages %}opacity-50 pointer-events-none{% endif %}">Next</a>
  </div>
  {% endif %}
</div>
{% endblock %}
