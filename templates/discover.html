{% extends "base.html" %}
{% block content %}
<div class="mb-24">
  <div class="flex items-center justify-between mb-4">
    <div class="text-2xl font-semibold">Weekly Discover</div>
    {% if weekly %}
    <form method="post" action="{{ url_for('discover_regen') }}">
      <button class="px-4 py-2 rounded-xl border">Regenerate</button>
    </form>
    {% endif %}
  </div>

  {% if picks %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for p in picks %}
    <div class="rounded-2xl border bg-white p-4">
      <img src="{{ p.image_url or '/static/img/placeholder.jpg' }}" class="w-full h-28 object-cover rounded-xl mb-3">
      <div class="font-semibold">{{ p.name }}</div>
      <div class="text-sm text-gray-500">{{ p.cuisine or '—' }} • {{ p.time_min or 0 }}m</div>
      <div class="flex items-center gap-2 mt-2">
        {% if p.source == 'web' %}
          <span class="px-2 py-1 rounded-full bg-amber-100 text-amber-700 text-xs">From Web</span>
          {% if p.source_url %}
            <a href="{{ p.source_url }}" target="_blank" class="text-xs text-emerald-700 underline">Open recipe</a>
          {% endif %}
        {% else %}
          <span class="px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs">From Library</span>
        {% endif %}
      </div>
      {% if p.source == 'web' %}
      <form method="post" action="{{ url_for('library_add') }}" class="mt-3" enctype="multipart/form-data">
        <input type="hidden" name="name" value="{{ p.name }}">
        <input type="hidden" name="ingredients" value="">
        <input type="hidden" name="time_min" value="{{ p.time_min or 40 }}">
        <input type="hidden" name="cuisine" value="{{ p.cuisine or '' }}">
        <input type="hidden" name="difficulty" value="{{ p.difficulty or 'Medium' }}">
        <input type="hidden" name="spice_level" value="Medium">
        <input type="hidden" name="veg" value="{{ p.veg or 0 }}">
        <input type="hidden" name="image_url" value="{{ p.image_url }}">
        <button class="w-full border rounded-lg py-2">Import</button>
      </form>
      {% else %}
      <form method="post" action="{{ url_for('discover_add') }}" class="mt-3">
        <input type="hidden" name="dish_id" value="{{ p.dish_id }}">
        <button class="w-full border rounded-lg py-2">Add to Library</button>
      </form>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="rounded-2xl border bg-white p-6 text-center text-gray-500">No suggestions right now.</div>
  {% endif %}
</div>
{% endblock %}
